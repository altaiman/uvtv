'use strict';

(function (root) {

  // svg for all
  svg4everybody();
  scrollTo();

  var sliderOptions = {
    'items': {
      cellAlign: 'left',
      pageDots: false,
      prevNextButtons: false
    }
  };

  document.querySelectorAll('[data-slider]').forEach(function (slider, i) {
    var slides = slider.querySelector('[data-slider-slides]'),
        slidesCount = slides.children.length,
        sliderData = slider.dataset.slider,
        options = sliderOptions[sliderData],
        sliderWidth = slider.offsetWidth,
        slideWidth = slides.children[0].offsetWidth,
        slidesCapacity = Math.round(sliderWidth / slideWidth),
        controls = slider.querySelector('[data-slider-controls]'),
        controlsPrev = controls.querySelector('[data-slider-controls-prev]'),
        controlsNext = controls.querySelector('[data-slider-controls-next]'),
        controlsEndIndex = slidesCount - slidesCapacity,
        adaptive = Number(slider.dataset.sliderAdaptive),
        windowWidth = window.innerWidth,
        progressBar = slider.querySelector('[data-slider-progress]'),
        progressStep = Math.round(100 / (slidesCount - slidesCapacity + 1));

    progressBar.style.width = progressStep + '%';

    if (slidesCount > slidesCapacity) {
      slider.classList.add('slider_initial');
      var flkty = new Flickity(slides, sliderOptions[slider.dataset.slider]);

      if (controls) {
        controlsPrev.addEventListener('click', function (e) {
          e.preventDefault();
          flkty.previous();
          // let progressCurrent = parseInt(progressBar.style.left) || 0
          // progressBar.style.left = `${progressCurrent-progressStep}%`
        });

        controlsNext.addEventListener('click', function (e) {
          e.preventDefault();
          flkty.next();
          // let progressCurrent = parseInt(progressBar.style.left) || 0
          // progressBar.style.left = `${progressCurrent+progressStep}%`
        });

        if (flkty.selectedIndex === 0) {
          controlsPrev.disabled = true;
        } else if (flkty.selectedIndex === controlsEndIndex) {
          controlsNext.disabled = true;
        }

        flkty.on('select', function (index) {
          var progressCurrent = parseInt(progressBar.style.left) || 0;

          controlsPrev.disabled = index == 0 ? true : false;
          controlsNext.disabled = index == controlsEndIndex ? true : false;

          progressBar.style.left = progressStep * index + '%';
        });

        flkty.on('change', function (index) {
          if (index >= controlsEndIndex) {
            flkty.select(controlsEndIndex);
          }
        });
      }
    }
  });

  // drop

  document.addEventListener('click', function (e) {
    var drop = document.querySelector('[data-drop-state="1"]');

    if (drop && !e.target.closest('.drop.show') && !e.target.closest('[data-drop-state="1"]')) {
      e.preventDefault();
      drop.click();
    }
  });

  document.querySelectorAll('[data-drop]').forEach(function (drop, i) {
    drop.addEventListener('click', function (e) {
      e.preventDefault();

      var data = drop.dataset.drop,
          dropContent = document.querySelector('[data-drop-content="' + data + '"]'),
          state = Number(drop.dataset.dropState);

      switch (state) {
        case 0:
          dropContent.classList.add('show');
          break;
        case 1:
          dropContent.classList.remove('show');
          break;
      }

      drop.dataset.dropState = Number(!state);
    });

    drop.addEventListener('keydown', function (e) {
      if (e.keyCode === 13) {
        e.preventDefault();
        e.target.click();
      }
    });
  });

  // modals
  document.querySelectorAll('[data-modal-open]').forEach(function (trigger, i) {
    trigger.addEventListener('click', function (e) {
      e.preventDefault();

      var t = e.target.closest('[data-modal-open]'),
          data = t.dataset.modalOpen,
          modalElement = document.querySelector('[data-modal="' + data + '"]');

      var modalContent = modalElement.innerHTML;

      if (data == 'gallery') {
        modalContent = t.innerHTML;
      }

      var modal = new tingle.modal({
        closeMethods: ['overlay', 'escape'],
        onClose: function onClose() {
          this.remove();
        },
        cssClass: modalElement.classList
      });

      modal.setContent(modalContent);
      modal.open();

      var forms = modal.modalBoxContent.querySelectorAll('form');

      try {
        document.querySelector('.modal__close').addEventListener('click', function (e) {
          e.preventDefault();
          modal.close();
        });
      } catch (e) {}
    });
  });
})(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJyb290Iiwic3ZnNGV2ZXJ5Ym9keSIsInNjcm9sbFRvIiwic2xpZGVyT3B0aW9ucyIsImNlbGxBbGlnbiIsInBhZ2VEb3RzIiwicHJldk5leHRCdXR0b25zIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInNsaWRlciIsImkiLCJzbGlkZXMiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVzQ291bnQiLCJjaGlsZHJlbiIsImxlbmd0aCIsInNsaWRlckRhdGEiLCJkYXRhc2V0Iiwib3B0aW9ucyIsInNsaWRlcldpZHRoIiwib2Zmc2V0V2lkdGgiLCJzbGlkZVdpZHRoIiwic2xpZGVzQ2FwYWNpdHkiLCJNYXRoIiwicm91bmQiLCJjb250cm9scyIsImNvbnRyb2xzUHJldiIsImNvbnRyb2xzTmV4dCIsImNvbnRyb2xzRW5kSW5kZXgiLCJhZGFwdGl2ZSIsIk51bWJlciIsInNsaWRlckFkYXB0aXZlIiwid2luZG93V2lkdGgiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwicHJvZ3Jlc3NCYXIiLCJwcm9ncmVzc1N0ZXAiLCJzdHlsZSIsIndpZHRoIiwiY2xhc3NMaXN0IiwiYWRkIiwiZmxrdHkiLCJGbGlja2l0eSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJwcmV2aW91cyIsIm5leHQiLCJzZWxlY3RlZEluZGV4IiwiZGlzYWJsZWQiLCJvbiIsImluZGV4IiwicHJvZ3Jlc3NDdXJyZW50IiwicGFyc2VJbnQiLCJsZWZ0Iiwic2VsZWN0IiwiZHJvcCIsInRhcmdldCIsImNsb3Nlc3QiLCJjbGljayIsImRhdGEiLCJkcm9wQ29udGVudCIsInN0YXRlIiwiZHJvcFN0YXRlIiwicmVtb3ZlIiwia2V5Q29kZSIsInRyaWdnZXIiLCJ0IiwibW9kYWxPcGVuIiwibW9kYWxFbGVtZW50IiwibW9kYWxDb250ZW50IiwiaW5uZXJIVE1MIiwibW9kYWwiLCJ0aW5nbGUiLCJjbG9zZU1ldGhvZHMiLCJvbkNsb3NlIiwiY3NzQ2xhc3MiLCJzZXRDb250ZW50Iiwib3BlbiIsImZvcm1zIiwibW9kYWxCb3hDb250ZW50IiwiY2xvc2UiXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBQyxVQUFTQSxJQUFULEVBQWU7O0FBRWQ7QUFDQUM7QUFDQUM7O0FBRUEsTUFBTUMsZ0JBQWdCO0FBQ3BCLGFBQVM7QUFDUEMsaUJBQVcsTUFESjtBQUVQQyxnQkFBVSxLQUZIO0FBR1BDLHVCQUFpQjtBQUhWO0FBRFcsR0FBdEI7O0FBUUFDLFdBQVNDLGdCQUFULENBQTBCLGVBQTFCLEVBQTJDQyxPQUEzQyxDQUFtRCxVQUFDQyxNQUFELEVBQVNDLENBQVQsRUFBZTtBQUNoRSxRQUFNQyxTQUFTRixPQUFPRyxhQUFQLENBQXFCLHNCQUFyQixDQUFmO0FBQUEsUUFDTUMsY0FBY0YsT0FBT0csUUFBUCxDQUFnQkMsTUFEcEM7QUFBQSxRQUVNQyxhQUFhUCxPQUFPUSxPQUFQLENBQWVSLE1BRmxDO0FBQUEsUUFHTVMsVUFBVWhCLGNBQWNjLFVBQWQsQ0FIaEI7QUFBQSxRQUlNRyxjQUFjVixPQUFPVyxXQUozQjtBQUFBLFFBS01DLGFBQWFWLE9BQU9HLFFBQVAsQ0FBZ0IsQ0FBaEIsRUFBbUJNLFdBTHRDO0FBQUEsUUFNTUUsaUJBQWlCQyxLQUFLQyxLQUFMLENBQVdMLGNBQVlFLFVBQXZCLENBTnZCO0FBQUEsUUFPTUksV0FBV2hCLE9BQU9HLGFBQVAsQ0FBcUIsd0JBQXJCLENBUGpCO0FBQUEsUUFRTWMsZUFBZUQsU0FBU2IsYUFBVCxDQUF1Qiw2QkFBdkIsQ0FSckI7QUFBQSxRQVNNZSxlQUFlRixTQUFTYixhQUFULENBQXVCLDZCQUF2QixDQVRyQjtBQUFBLFFBVU1nQixtQkFBbUJmLGNBQWNTLGNBVnZDO0FBQUEsUUFXTU8sV0FBV0MsT0FBT3JCLE9BQU9RLE9BQVAsQ0FBZWMsY0FBdEIsQ0FYakI7QUFBQSxRQVlNQyxjQUFjQyxPQUFPQyxVQVozQjtBQUFBLFFBYU1DLGNBQWMxQixPQUFPRyxhQUFQLENBQXFC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QyxZQUFNSyxVQUFOLENBQWlCUCxZQUFqQjtBQUNBRSxZQUFNTSxJQUFOOztBQUVBLFVBQU1DLFFBQVFQLE1BQU1RLGVBQU4sQ0FBc0J6RSxnQkFBdEIsQ0FBdUMsTUFBdkMsQ0FBZDs7QUFFQSxVQUFJO0FBQ0ZELGlCQUFTTSxhQUFULENBQXVCLGVBQXZCLEVBQXdDK0IsZ0JBQXhDLENBQXlELE9BQXpELEVBQWtFLFVBQUNDLENBQUQsRUFBTztBQUN2RUEsWUFBRUMsY0FBRjtBQUNBMkIsZ0JBQU1TLEtBQU47QUFDRCxTQUhEO0FBSUQsT0FMRCxDQUtFLE9BQU9yQyxDQUFQLEVBQVUsQ0FFWDtBQUNGLEtBbENEO0FBbUNELEdBcENEO0FBdUNELENBL0pELEVBK0pHWCxNQS9KSCIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24ocm9vdCkge1xuXG4gIC8vIHN2ZyBmb3IgYWxsXG4gIHN2ZzRldmVyeWJvZHkoKVxuICBzY3JvbGxUbygpXG5cbiAgY29uc3Qgc2xpZGVyT3B0aW9ucyA9IHtcbiAgICAnaXRlbXMnOiB7XG4gICAgICBjZWxsQWxpZ246ICdsZWZ0JyxcbiAgICAgIHBhZ2VEb3RzOiBmYWxzZSxcbiAgICAgIHByZXZOZXh0QnV0dG9uczogZmFsc2UsXG4gICAgfVxuICB9XG5cbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtc2xpZGVyXScpLmZvckVhY2goKHNsaWRlciwgaSkgPT4ge1xuICAgIGNvbnN0IHNsaWRlcyA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zbGlkZXItc2xpZGVzXScpLFxuICAgICAgICAgIHNsaWRlc0NvdW50ID0gc2xpZGVzLmNoaWxkcmVuLmxlbmd0aCxcbiAgICAgICAgICBzbGlkZXJEYXRhID0gc2xpZGVyLmRhdGFzZXQuc2xpZGVyLFxuICAgICAgICAgIG9wdGlvbnMgPSBzbGlkZXJPcHRpb25zW3NsaWRlckRhdGFdLFxuICAgICAgICAgIHNsaWRlcldpZHRoID0gc2xpZGVyLm9mZnNldFdpZHRoLFxuICAgICAgICAgIHNsaWRlV2lkdGggPSBzbGlkZXMuY2hpbGRyZW5bMF0ub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgc2xpZGVzQ2FwYWNpdHkgPSBNYXRoLnJvdW5kKHNsaWRlcldpZHRoL3NsaWRlV2lkdGgpLFxuICAgICAgICAgIGNvbnRyb2xzID0gc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNsaWRlci1jb250cm9sc10nKSxcbiAgICAgICAgICBjb250cm9sc1ByZXYgPSBjb250cm9scy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zbGlkZXItY29udHJvbHMtcHJldl0nKSxcbiAgICAgICAgICBjb250cm9sc05leHQgPSBjb250cm9scy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zbGlkZXItY29udHJvbHMtbmV4dF0nKSxcbiAgICAgICAgICBjb250cm9sc0VuZEluZGV4ID0gc2xpZGVzQ291bnQgLSBzbGlkZXNDYXBhY2l0eSxcbiAgICAgICAgICBhZGFwdGl2ZSA9IE51bWJlcihzbGlkZXIuZGF0YXNldC5zbGlkZXJBZGFwdGl2ZSksXG4gICAgICAgICAgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCxcbiAgICAgICAgICBwcm9ncmVzc0JhciA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zbGlkZXItcHJvZ3Jlc3NdJyksXG4gICAgICAgICAgcHJvZ3Jlc3NTdGVwID0gTWF0aC5yb3VuZCgxMDAgLyAoc2xpZGVzQ291bnQtc2xpZGVzQ2FwYWNpdHkrMSkpXG5cbiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IGAke3Byb2dyZXNzU3RlcH0lYFxuXG4gICAgaWYgKHNsaWRlc0NvdW50ID4gc2xpZGVzQ2FwYWNpdHkpIHtcbiAgICAgIHNsaWRlci5jbGFzc0xpc3QuYWRkKCdzbGlkZXJfaW5pdGlhbCcpXG4gICAgICBjb25zdCBmbGt0eSA9IG5ldyBGbGlja2l0eShzbGlkZXMsIHNsaWRlck9wdGlvbnNbc2xpZGVyLmRhdGFzZXQuc2xpZGVyXSk7XG5cbiAgICAgIGlmIChjb250cm9scykge1xuICAgICAgICBjb250cm9sc1ByZXZcbiAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBmbGt0eS5wcmV2aW91cygpXG4gICAgICAgICAgICAvLyBsZXQgcHJvZ3Jlc3NDdXJyZW50ID0gcGFyc2VJbnQocHJvZ3Jlc3NCYXIuc3R5bGUubGVmdCkgfHwgMFxuICAgICAgICAgICAgLy8gcHJvZ3Jlc3NCYXIuc3R5bGUubGVmdCA9IGAke3Byb2dyZXNzQ3VycmVudC1wcm9ncmVzc1N0ZXB9JWBcbiAgICAgICAgICB9KVxuXG4gICAgICAgIGNvbnRyb2xzTmV4dFxuICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgIGZsa3R5Lm5leHQoKVxuICAgICAgICAgICAgLy8gbGV0IHByb2dyZXNzQ3VycmVudCA9IHBhcnNlSW50KHByb2dyZXNzQmFyLnN0eWxlLmxlZnQpIHx8IDBcbiAgICAgICAgICAgIC8vIHByb2dyZXNzQmFyLnN0eWxlLmxlZnQgPSBgJHtwcm9ncmVzc0N1cnJlbnQrcHJvZ3Jlc3NTdGVwfSVgXG4gICAgICAgICAgfSlcblxuICAgICAgICBpZiAoZmxrdHkuc2VsZWN0ZWRJbmRleCA9PT0gMCkge1xuICAgICAgICAgIGNvbnRyb2xzUHJldi5kaXNhYmxlZCA9IHRydWVcbiAgICAgICAgfSBlbHNlIGlmIChmbGt0eS5zZWxlY3RlZEluZGV4ID09PSBjb250cm9sc0VuZEluZGV4KSB7XG4gICAgICAgICAgY29udHJvbHNOZXh0LmRpc2FibGVkID0gdHJ1ZVxuICAgICAgICB9XG5cbiAgICAgICAgZmxrdHkub24oJ3NlbGVjdCcsIChpbmRleCkgPT4ge1xuICAgICAgICAgIGxldCBwcm9ncmVzc0N1cnJlbnQgPSBwYXJzZUludChwcm9ncmVzc0Jhci5zdHlsZS5sZWZ0KSB8fCAwXG5cbiAgICAgICAgICBjb250cm9sc1ByZXYuZGlzYWJsZWQgPSAoaW5kZXggPT0gMCkgPyB0cnVlIDogZmFsc2VcbiAgICAgICAgICBjb250cm9sc05leHQuZGlzYWJsZWQgPSAoaW5kZXggPT0gY29udHJvbHNFbmRJbmRleCkgPyB0cnVlIDogZmFsc2VcblxuICAgICAgICAgIHByb2dyZXNzQmFyLnN0eWxlLmxlZnQgPSBgJHtwcm9ncmVzc1N0ZXAqaW5kZXh9JWBcbiAgICAgICAgfSlcblxuICAgICAgICBmbGt0eS5vbignY2hhbmdlJywgKGluZGV4KSA9PiB7XG4gICAgICAgICAgaWYgKGluZGV4ID49IGNvbnRyb2xzRW5kSW5kZXgpIHtcbiAgICAgICAgICAgIGZsa3R5LnNlbGVjdChjb250cm9sc0VuZEluZGV4KVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH0pXG5cbiAgLy8gZHJvcFxuXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICBjb25zdCBkcm9wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtZHJvcC1zdGF0ZT1cIjFcIl0nKVxuXG4gICAgaWYgKGRyb3AgJiYgIWUudGFyZ2V0LmNsb3Nlc3QoJy5kcm9wLnNob3cnKSAmJiAhZS50YXJnZXQuY2xvc2VzdCgnW2RhdGEtZHJvcC1zdGF0ZT1cIjFcIl0nKSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICBkcm9wLmNsaWNrKClcbiAgICB9XG5cbiAgfSlcblxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1kcm9wXScpLmZvckVhY2goKGRyb3AsIGkpID0+IHtcbiAgICBkcm9wLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgICBjb25zdCBkYXRhID0gZHJvcC5kYXRhc2V0LmRyb3AsXG4gICAgICAgICAgICBkcm9wQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWRyb3AtY29udGVudD1cIiR7ZGF0YX1cIl1gKSxcbiAgICAgICAgICAgIHN0YXRlID0gTnVtYmVyKGRyb3AuZGF0YXNldC5kcm9wU3RhdGUpXG5cbiAgICAgIHN3aXRjaCAoc3RhdGUpIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICAgIGRyb3BDb250ZW50LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICBkcm9wQ29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93JylcbiAgICAgICAgICBicmVha1xuICAgICAgfVxuXG4gICAgICBkcm9wLmRhdGFzZXQuZHJvcFN0YXRlID0gTnVtYmVyKCFzdGF0ZSlcblxuICAgIH0pXG5cbiAgICBkcm9wLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4ge1xuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgIGUudGFyZ2V0LmNsaWNrKClcbiAgICAgIH1cbiAgICB9KVxuICB9KVxuXG4gIC8vIG1vZGFsc1xuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1tb2RhbC1vcGVuXScpLmZvckVhY2goKHRyaWdnZXIsIGkpID0+IHtcbiAgICB0cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgICBjb25zdCB0ID0gZS50YXJnZXQuY2xvc2VzdCgnW2RhdGEtbW9kYWwtb3Blbl0nKSxcbiAgICAgICAgICAgIGRhdGEgPSB0LmRhdGFzZXQubW9kYWxPcGVuLFxuICAgICAgICAgICAgbW9kYWxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtbW9kYWw9XCIke2RhdGF9XCJdYClcblxuICAgICAgbGV0IG1vZGFsQ29udGVudCA9IG1vZGFsRWxlbWVudC5pbm5lckhUTUxcblxuICAgICAgaWYgKGRhdGEgPT0gJ2dhbGxlcnknKSB7XG4gICAgICAgIG1vZGFsQ29udGVudCA9IHQuaW5uZXJIVE1MXG4gICAgICB9XG5cbiAgICAgIGxldCBtb2RhbCA9IG5ldyB0aW5nbGUubW9kYWwoe1xuICAgICAgICBjbG9zZU1ldGhvZHM6IFsnb3ZlcmxheScsICdlc2NhcGUnXSxcbiAgICAgICAgb25DbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdGhpcy5yZW1vdmUoKVxuICAgICAgICB9LFxuICAgICAgICBjc3NDbGFzczogbW9kYWxFbGVtZW50LmNsYXNzTGlzdFxuICAgICAgfSk7XG5cbiAgICAgIG1vZGFsLnNldENvbnRlbnQobW9kYWxDb250ZW50KVxuICAgICAgbW9kYWwub3BlbigpXG5cbiAgICAgIGNvbnN0IGZvcm1zID0gbW9kYWwubW9kYWxCb3hDb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Zvcm0nKVxuXG4gICAgICB0cnkge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgIG1vZGFsLmNsb3NlKClcbiAgICAgICAgfSlcbiAgICAgIH0gY2F0Y2ggKGUpIHtcblxuICAgICAgfVxuICAgIH0pXG4gIH0pXG5cblxufSkod2luZG93KTtcbiJdfQ==
