'use strict';

(function (root) {

  // svg for all
  svg4everybody();
  scrollTo();

  var sliderOptions = {
    'items': {
      cellAlign: 'left',
      pageDots: false,
      prevNextButtons: false,
      draggable: false
    }
  };

  document.querySelectorAll('[data-slider]').forEach(function (slider, i) {
    var slides = slider.querySelector('[data-slider-slides]'),
        slidesCount = slides.children.length,
        sliderData = slider.dataset.slider,
        options = sliderOptions[sliderData],
        sliderWidth = slider.offsetWidth,
        slideWidth = slides.children[0].offsetWidth,
        slidesCapacity = Math.round(sliderWidth / slideWidth),
        controls = slider.querySelector('[data-slider-controls]'),
        controlsPrev = controls.querySelector('[data-slider-controls-prev]'),
        controlsNext = controls.querySelector('[data-slider-controls-next]'),
        controlsEndIndex = slidesCount - slidesCapacity,
        adaptive = Number(slider.dataset.sliderAdaptive),
        windowWidth = window.innerWidth;

    if (slidesCount > slidesCapacity) {
      slider.classList.add('slider_initial');
      var flkty = new Flickity(slides, sliderOptions[slider.dataset.slider]);

      if (controls) {
        controlsPrev.addEventListener('click', function (e) {
          e.preventDefault();
          flkty.previous();
        });

        controlsNext.addEventListener('click', function (e) {
          e.preventDefault();
          flkty.next();
        });

        if (flkty.selectedIndex === 0) {
          controlsPrev.disabled = true;
        } else if (flkty.selectedIndex === controlsEndIndex) {
          controlsNext.disabled = true;
        }

        flkty.on('select', function (index) {
          controlsPrev.disabled = index == 0 ? true : false;
          controlsNext.disabled = index == controlsEndIndex ? true : false;
        });
      }
    }
  });

  // drop

  document.addEventListener('click', function (e) {
    var drop = document.querySelector('[data-drop-state="1"]');

    if (drop && !e.target.closest('.drop.show') && !e.target.closest('[data-drop-state="1"]')) {
      e.preventDefault();
      drop.click();
    }
  });

  document.querySelectorAll('[data-drop]').forEach(function (drop, i) {
    drop.addEventListener('click', function (e) {
      e.preventDefault();

      var data = drop.dataset.drop,
          dropContent = document.querySelector('[data-drop-content="' + data + '"]'),
          state = Number(drop.dataset.dropState);

      switch (state) {
        case 0:
          dropContent.classList.add('show');
          break;
        case 1:
          dropContent.classList.remove('show');
          break;
      }

      drop.dataset.dropState = Number(!state);
    });

    drop.addEventListener('keydown', function (e) {
      if (e.keyCode === 13) {
        e.preventDefault();
        e.target.click();
      }
    });
  });

  // modals
  document.querySelectorAll('[data-modal-open]').forEach(function (trigger, i) {
    trigger.addEventListener('click', function (e) {
      e.preventDefault();

      var t = e.target.closest('[data-modal-open]'),
          data = t.dataset.modalOpen,
          modalElement = document.querySelector('[data-modal="' + data + '"]');

      var modalContent = modalElement.innerHTML;

      if (data == 'gallery') {
        modalContent = t.innerHTML;
      }

      var modal = new tingle.modal({
        closeMethods: ['overlay', 'escape'],
        onClose: function onClose() {
          this.remove();
        },
        cssClass: modalElement.classList
      });

      modal.setContent(modalContent);
      modal.open();

      var forms = modal.modalBoxContent.querySelectorAll('form');

      try {
        document.querySelector('.modal__close').addEventListener('click', function (e) {
          e.preventDefault();
          modal.close();
        });
      } catch (e) {}
    });
  });
})(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJyb290Iiwic3ZnNGV2ZXJ5Ym9keSIsInNjcm9sbFRvIiwic2xpZGVyT3B0aW9ucyIsImNlbGxBbGlnbiIsInBhZ2VEb3RzIiwicHJldk5leHRCdXR0b25zIiwiZHJhZ2dhYmxlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInNsaWRlciIsImkiLCJzbGlkZXMiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVzQ291bnQiLCJjaGlsZHJlbiIsImxlbmd0aCIsInNsaWRlckRhdGEiLCJkYXRhc2V0Iiwib3B0aW9ucyIsInNsaWRlcldpZHRoIiwib2Zmc2V0V2lkdGgiLCJzbGlkZVdpZHRoIiwic2xpZGVzQ2FwYWNpdHkiLCJNYXRoIiwicm91bmQiLCJjb250cm9scyIsImNvbnRyb2xzUHJldiIsImNvbnRyb2xzTmV4dCIsImNvbnRyb2xzRW5kSW5kZXgiLCJhZGFwdGl2ZSIsIk51bWJlciIsInNsaWRlckFkYXB0aXZlIiwid2luZG93V2lkdGgiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwiY2xhc3NMaXN0IiwiYWRkIiwiZmxrdHkiLCJGbGlja2l0eSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJwcmV2aW91cyIsIm5leHQiLCJzZWxlY3RlZEluZGV4IiwiZGlzYWJsZWQiLCJvbiIsImluZGV4IiwiZHJvcCIsInRhcmdldCIsImNsb3Nlc3QiLCJjbGljayIsImRhdGEiLCJkcm9wQ29udGVudCIsInN0YXRlIiwiZHJvcFN0YXRlIiwicmVtb3ZlIiwia2V5Q29kZSIsInRyaWdnZXIiLCJ0IiwibW9kYWxPcGVuIiwibW9kYWxFbGVtZW50IiwibW9kYWxDb250ZW50IiwiaW5uZXJIVE1MIiwibW9kYWwiLCJ0aW5nbGUiLCJjbG9zZU1ldGhvZHMiLCJvbkNsb3NlIiwiY3NzQ2xhc3MiLCJzZXRDb250ZW50Iiwib3BlbiIsImZvcm1zIiwibW9kYWxCb3hDb250ZW50IiwiY2xv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VUFBTWtCLElBQUluQixFQUFFUyxNQUFGLENBQVNDLE9BQVQsQ0FBaUIsbUJBQWpCLENBQVY7QUFBQSxVQUNNRSxPQUFPTyxFQUFFMUMsT0FBRixDQUFVMkMsU0FEdkI7QUFBQSxVQUVNQyxlQUFldkQsU0FBU00sYUFBVCxtQkFBdUN3QyxJQUF2QyxRQUZyQjs7QUFJQSxVQUFJVSxlQUFlRCxhQUFhRSxTQUFoQzs7QUFFQSxVQUFJWCxRQUFRLFNBQVosRUFBdUI7QUFDckJVLHVCQUFlSCxFQUFFSSxTQUFqQjtBQUNEOztBQUVELFVBQUlDLFFBQVEsSUFBSUMsT0FBT0QsS0FBWCxDQUFpQjtBQUMzQkUsc0JBQWMsQ0FBQyxTQUFELEVBQVksUUFBWixDQURhO0FBRTNCQyxpQkFBUyxtQkFBVztBQUNsQixlQUFLWCxNQUFMO0FBQ0QsU0FKMEI7QUFLM0JZLGtCQUFVUCxhQUFhMUI7QUFMSSxPQUFqQixDQUFaOztBQVFBNkIsWUFBTUssVUFBTixDQUFpQlAsWUFBakI7QUFDQUUsWUFBTU0sSUFBTjs7QUFFQSxVQUFNQyxRQUFRUCxNQUFNUSxlQUFOLENBQXNCakUsZ0JBQXRCLENBQXVDLE1BQXZDLENBQWQ7O0FBRUEsVUFBSTtBQUNGRCxpQkFBU00sYUFBVCxDQUF1QixlQUF2QixFQUF3QzJCLGdCQUF4QyxDQUF5RCxPQUF6RCxFQUFrRSxVQUFDQyxDQUFELEVBQU87QUFDdkVBLFlBQUVDLGNBQUY7QUFDQXVCLGdCQUFNUyxLQUFOO0FBQ0QsU0FIRDtBQUlELE9BTEQsQ0FLRSxPQUFPakMsQ0FBUCxFQUFVLENBRVg7QUFDRixLQWxDRDtBQW1DRCxHQXBDRDtBQXVDRCxDQTlJRCxFQThJR1AsTUE5SUgiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKHJvb3QpIHtcblxuICAvLyBzdmcgZm9yIGFsbFxuICBzdmc0ZXZlcnlib2R5KClcbiAgc2Nyb2xsVG8oKVxuXG4gIGNvbnN0IHNsaWRlck9wdGlvbnMgPSB7XG4gICAgJ2l0ZW1zJzoge1xuICAgICAgY2VsbEFsaWduOiAnbGVmdCcsXG4gICAgICBwYWdlRG90czogZmFsc2UsXG4gICAgICBwcmV2TmV4dEJ1dHRvbnM6IGZhbHNlLFxuICAgICAgZHJhZ2dhYmxlOiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXNsaWRlcl0nKS5mb3JFYWNoKChzbGlkZXIsIGkpID0+IHtcbiAgICBjb25zdCBzbGlkZXMgPSBzbGlkZXIucXVlcnlTZWxlY3RvcignW2RhdGEtc2xpZGVyLXNsaWRlc10nKSxcbiAgICAgICAgICBzbGlkZXNDb3VudCA9IHNsaWRlcy5jaGlsZHJlbi5sZW5ndGgsXG4gICAgICAgICAgc2xpZGVyRGF0YSA9IHNsaWRlci5kYXRhc2V0LnNsaWRlcixcbiAgICAgICAgICBvcHRpb25zID0gc2xpZGVyT3B0aW9uc1tzbGlkZXJEYXRhXSxcbiAgICAgICAgICBzbGlkZXJXaWR0aCA9IHNsaWRlci5vZmZzZXRXaWR0aCxcbiAgICAgICAgICBzbGlkZVdpZHRoID0gc2xpZGVzLmNoaWxkcmVuWzBdLm9mZnNldFdpZHRoLFxuICAgICAgICAgIHNsaWRlc0NhcGFjaXR5ID0gTWF0aC5yb3VuZChzbGlkZXJXaWR0aC9zbGlkZVdpZHRoKSxcbiAgICAgICAgICBjb250cm9scyA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zbGlkZXItY29udHJvbHNdJyksXG4gICAgICAgICAgY29udHJvbHNQcmV2ID0gY29udHJvbHMucXVlcnlTZWxlY3RvcignW2RhdGEtc2xpZGVyLWNvbnRyb2xzLXByZXZdJyksXG4gICAgICAgICAgY29udHJvbHNOZXh0ID0gY29udHJvbHMucXVlcnlTZWxlY3RvcignW2RhdGEtc2xpZGVyLWNvbnRyb2xzLW5leHRdJyksXG4gICAgICAgICAgY29udHJvbHNFbmRJbmRleCA9IHNsaWRlc0NvdW50IC0gc2xpZGVzQ2FwYWNpdHksXG4gICAgICAgICAgYWRhcHRpdmUgPSBOdW1iZXIoc2xpZGVyLmRhdGFzZXQuc2xpZGVyQWRhcHRpdmUpLFxuICAgICAgICAgIHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGhcblxuICAgIGlmIChzbGlkZXNDb3VudCA+IHNsaWRlc0NhcGFjaXR5KSB7XG4gICAgICBzbGlkZXIuY2xhc3NMaXN0LmFkZCgnc2xpZGVyX2luaXRpYWwnKVxuICAgICAgY29uc3QgZmxrdHkgPSBuZXcgRmxpY2tpdHkoc2xpZGVzLCBzbGlkZXJPcHRpb25zW3NsaWRlci5kYXRhc2V0LnNsaWRlcl0pO1xuXG4gICAgICBpZiAoY29udHJvbHMpIHtcbiAgICAgICAgY29udHJvbHNQcmV2XG4gICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgZmxrdHkucHJldmlvdXMoKVxuICAgICAgICAgIH0pXG5cbiAgICAgICAgY29udHJvbHNOZXh0XG4gICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgZmxrdHkubmV4dCgpXG4gICAgICAgICAgfSlcblxuICAgICAgICBpZiAoZmxrdHkuc2VsZWN0ZWRJbmRleCA9PT0gMCkge1xuICAgICAgICAgIGNvbnRyb2xzUHJldi5kaXNhYmxlZCA9IHRydWVcbiAgICAgICAgfSBlbHNlIGlmIChmbGt0eS5zZWxlY3RlZEluZGV4ID09PSBjb250cm9sc0VuZEluZGV4KSB7XG4gICAgICAgICAgY29udHJvbHNOZXh0LmRpc2FibGVkID0gdHJ1ZVxuICAgICAgICB9XG5cbiAgICAgICAgZmxrdHkub24oJ3NlbGVjdCcsIChpbmRleCkgPT4ge1xuICAgICAgICAgIGNvbnRyb2xzUHJldi5kaXNhYmxlZCA9IChpbmRleCA9PSAwKSA/IHRydWUgOiBmYWxzZVxuICAgICAgICAgIGNvbnRyb2xzTmV4dC5kaXNhYmxlZCA9IChpbmRleCA9PSBjb250cm9sc0VuZEluZGV4KSA/IHRydWUgOiBmYWxzZVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfSlcblxuICAvLyBkcm9wXG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIGNvbnN0IGRyb3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1kcm9wLXN0YXRlPVwiMVwiXScpXG5cbiAgICBpZiAoZHJvcCAmJiAhZS50YXJnZXQuY2xvc2VzdCgnLmRyb3Auc2hvdycpICYmICFlLnRhcmdldC5jbG9zZXN0KCdbZGF0YS1kcm9wLXN0YXRlPVwiMVwiXScpKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIGRyb3AuY2xpY2soKVxuICAgIH1cblxuICB9KVxuXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWRyb3BdJykuZm9yRWFjaCgoZHJvcCwgaSkgPT4ge1xuICAgIGRyb3AuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICAgIGNvbnN0IGRhdGEgPSBkcm9wLmRhdGFzZXQuZHJvcCxcbiAgICAgICAgICAgIGRyb3BDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtZHJvcC1jb250ZW50PVwiJHtkYXRhfVwiXWApLFxuICAgICAgICAgICAgc3RhdGUgPSBOdW1iZXIoZHJvcC5kYXRhc2V0LmRyb3BTdGF0ZSlcblxuICAgICAgc3dpdGNoIChzdGF0ZSkge1xuICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgZHJvcENvbnRlbnQuY2xhc3NMaXN0LmFkZCgnc2hvdycpXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIGRyb3BDb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKVxuICAgICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGRyb3AuZGF0YXNldC5kcm9wU3RhdGUgPSBOdW1iZXIoIXN0YXRlKVxuXG4gICAgfSlcblxuICAgIGRyb3AuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XG4gICAgICBpZiAoZS5rZXlDb2RlID09PSAxMykge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgZS50YXJnZXQuY2xpY2soKVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG5cbiAgLy8gbW9kYWxzXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLW1vZGFsLW9wZW5dJykuZm9yRWFjaCgodHJpZ2dlciwgaSkgPT4ge1xuICAgIHRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICAgIGNvbnN0IHQgPSBlLnRhcmdldC5jbG9zZXN0KCdbZGF0YS1tb2RhbC1vcGVuXScpLFxuICAgICAgICAgICAgZGF0YSA9IHQuZGF0YXNldC5tb2RhbE9wZW4sXG4gICAgICAgICAgICBtb2RhbEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1tb2RhbD1cIiR7ZGF0YX1cIl1gKVxuXG4gICAgICBsZXQgbW9kYWxDb250ZW50ID0gbW9kYWxFbGVtZW50LmlubmVySFRNTFxuXG4gICAgICBpZiAoZGF0YSA9PSAnZ2FsbGVyeScpIHtcbiAgICAgICAgbW9kYWxDb250ZW50ID0gdC5pbm5lckhUTUxcbiAgICAgIH1cblxuICAgICAgbGV0IG1vZGFsID0gbmV3IHRpbmdsZS5tb2RhbCh7XG4gICAgICAgIGNsb3NlTWV0aG9kczogWydvdmVybGF5JywgJ2VzY2FwZSddLFxuICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB0aGlzLnJlbW92ZSgpXG4gICAgICAgIH0sXG4gICAgICAgIGNzc0NsYXNzOiBtb2RhbEVsZW1lbnQuY2xhc3NMaXN0XG4gICAgICB9KTtcblxuICAgICAgbW9kYWwuc2V0Q29udGVudChtb2RhbENvbnRlbnQpXG4gICAgICBtb2RhbC5vcGVuKClcblxuICAgICAgY29uc3QgZm9ybXMgPSBtb2RhbC5tb2RhbEJveENvbnRlbnQucXVlcnlTZWxlY3RvckFsbCgnZm9ybScpXG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgbW9kYWwuY2xvc2UoKVxuICAgICAgICB9KVxuICAgICAgfSBjYXRjaCAoZSkge1xuXG4gICAgICB9XG4gICAgfSlcbiAgfSlcblxuXG59KSh3aW5kb3cpO1xuIl19
