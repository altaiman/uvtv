'use strict';

(function (root) {

  // svg for all
  svg4everybody();
  scrollTo();

  var sliderOptions = {
    'items': {
      cellAlign: 'left',
      pageDots: false,
      prevNextButtons: false
    }
  };

  document.querySelectorAll('[data-slider]').forEach(function (slider, i) {
    var slides = slider.querySelector('[data-slider-slides]'),
        slidesCount = slides.children.length,
        sliderData = slider.dataset.slider,
        options = sliderOptions[sliderData],
        sliderWidth = slider.offsetWidth,
        slideWidth = slides.children[0].offsetWidth,
        slidesCapacity = Math.round(sliderWidth / slideWidth),
        controls = slider.querySelector('[data-slider-controls]'),
        controlsPrev = controls.querySelector('[data-slider-controls-prev]'),
        controlsNext = controls.querySelector('[data-slider-controls-next]'),
        controlsEndIndex = slidesCount - slidesCapacity,
        adaptive = Number(slider.dataset.sliderAdaptive),
        windowWidth = window.innerWidth,
        progressBar = slider.querySelector('[data-slider-progress]'),
        progressStep = Math.round(100 / (slidesCount - slidesCapacity + 1));

    progressBar.style.width = progressStep + '%';

    if (slidesCount > slidesCapacity) {
      slider.classList.add('slider_initial');
      var flkty = new Flickity(slides, sliderOptions[slider.dataset.slider]);

      if (controls) {
        controlsPrev.addEventListener('click', function (e) {
          e.preventDefault();
          flkty.previous();
        });

        controlsNext.addEventListener('click', function (e) {
          e.preventDefault();
          flkty.next();
        });

        if (flkty.selectedIndex === 0) {
          controlsPrev.disabled = true;
        } else if (flkty.selectedIndex === controlsEndIndex) {
          controlsNext.disabled = true;
        }

        flkty.on('select', function (index) {
          var progressCurrent = parseInt(progressBar.style.left) || 0;

          controlsPrev.disabled = index == 0 ? true : false;
          controlsNext.disabled = index == controlsEndIndex ? true : false;

          progressBar.style.left = progressStep * index + '%';
        });

        flkty.on('change', function (index) {
          if (index >= controlsEndIndex) {
            flkty.select(controlsEndIndex);
          }
        });
      }
    }
  });

  // drop

  document.addEventListener('click', function (e) {
    var drop = document.querySelector('[data-drop-state="1"]');

    if (drop && !e.target.closest('.drop.show') && !e.target.closest('[data-drop-state="1"]')) {
      e.preventDefault();
      drop.click();
    }
  });

  document.querySelectorAll('[data-drop]').forEach(function (drop, i) {
    drop.addEventListener('click', function (e) {
      e.preventDefault();

      var data = drop.dataset.drop,
          dropContent = document.querySelector('[data-drop-content="' + data + '"]'),
          state = Number(drop.dataset.dropState);

      switch (state) {
        case 0:
          dropContent.classList.add('show');
          break;
        case 1:
          dropContent.classList.remove('show');
          break;
      }

      drop.dataset.dropState = Number(!state);
    });

    drop.addEventListener('keydown', function (e) {
      if (e.keyCode === 13) {
        e.preventDefault();
        e.target.click();
      }
    });
  });

  // rating

  document.querySelectorAll('.rating').forEach(function (rating, i) {
    var value = Number(rating.querySelector('[data-stars]').dataset.stars);

    rating.querySelectorAll('.star').forEach(function (star, k) {
      if (k < value) {
        star.classList.add('star_fill');
      }
    });
  });

  function prevAll(element) {
    var result = [];

    while (element = element.previousElementSibling) {
      result.push(element);
    }return result;
  }

  function nextAll(element) {
    var result = [];

    while (element = element.nextElementSibling) {
      result.push(element);
    }return result;
  }

  function starFocus(star) {
    star.classList.add('star_hover');

    prevAll(star).forEach(function (el, k) {
      el.classList.add('star_hover');
    });

    nextAll(star).forEach(function (el, k) {
      el.classList.remove('star_hover');
    });
  }

  document.querySelectorAll('.star').forEach(function (star, i) {
    star.addEventListener('mouseenter', function (e) {
      starFocus(star);
    });

    star.addEventListener('focus', function (e) {
      starFocus(star);
    });

    star.addEventListener('mouseleave', function (e) {
      document.querySelectorAll('.star_hover').forEach(function (el, k) {
        el.classList.remove('star_hover');
      });
    });

    star.addEventListener('click', function (e) {
      e.preventDefault();
      star.classList.add('star_fill');

      prevAll(star).forEach(function (el, k) {
        el.classList.add('star_fill');
      });

      nextAll(star).forEach(function (el, k) {
        el.classList.remove('star_fill');
      });
    });

    star.addEventListener('keydown', function (e) {
      if (e.keyCode === 13) {
        e.preventDefault();
        star.click();
      }
    });
  });

  // select
  $('select').niceSelect();

  // side adaptive
  document.querySelector('.avatar').addEventListener('click', function (e) {
    if (window.outerWidth <= 768) {
      e.preventDefault();

      document.querySelector('.page__side').classList.toggle('page__side_show');
    }
  });

  // modals
  document.querySelectorAll('[data-modal-open]').forEach(function (trigger, i) {
    trigger.addEventListener('click', function (e) {
      e.preventDefault();

      var t = e.target.closest('[data-modal-open]'),
          data = t.dataset.modalOpen,
          modalElement = document.querySelector('[data-modal="' + data + '"]');

      var modalContent = modalElement.innerHTML;

      var modal = new tingle.modal({
        closeMethods: ['overlay', 'escape'],
        onClose: function onClose() {
          this.remove();
        },
        cssClass: modalElement.classList
      });

      modal.setContent(modalContent);
      modal.open();

      var forms = modal.modalBoxContent.querySelectorAll('form');

      try {
        document.querySelector('.modal__close').addEventListener('click', function (e) {
          e.preventDefault();
          modal.close();
        });
      } catch (e) {}
    });
  });
})(window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJyb290Iiwic3ZnNGV2ZXJ5Ym9keSIsInNjcm9sbFRvIiwic2xpZGVyT3B0aW9ucyIsImNlbGxBbGlnbiIsInBhZ2VEb3RzIiwicHJldk5leHRCdXR0b25zIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInNsaWRlciIsImkiLCJzbGlkZXMiLCJxdWVyeVNlbGVjdG9yIiwic2xpZGVzQ291bnQiLCJjaGlsZHJlbiIsImxlbmd0aCIsInNsaWRlckRhdGEiLCJkYXRhc2V0Iiwib3B0aW9ucyIsInNsaWRlcldpZHRoIiwib2Zmc2V0V2lkdGgiLCJzbGlkZVdpZHRoIiwic2xpZGVzQ2FwYWNpdHkiLCJNYXRoIiwicm91bmQiLCJjb250cm9scyIsImNvbnRyb2xzUHJldiIsImNvbnRyb2xzTmV4dCIsImNvbnRyb2xzRW5kSW5kZXgiLCJhZGFwdGl2ZSIsIk51bWJlciIsInNsaWRlckFkYXB0aXZlIiwid2luZG93V2lkdGgiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwicHJvZ3Jlc3NCYXIiLCJwcm9ncmVzc1N0ZXAiLCJzdHlsZSIsIndpZHRoIiwiY2xhc3NMaXN0IiwiYWRkIiwiZmxrdHkiLCJGbGlja2l0eSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJwcmV2aW91cyIsIm5leHQiLCJzZWxlY3RlZEluZGV4IiwiZGlzYWJsZWQiLCJvbiIsImluZGV4IiwicHJvZ3Jlc3NDdXJyZW50IiwicGFyc2VJbnQiLCJsZWZ0Iiwic2VsZWN0IiwiZHJvcCIsInRhcmdldCIsImNsb3Nlc3QiLCJjbGljayIsImRhdGEiLCJkcm9wQ29udGVudCIsInN0YXRlIiwiZHJvcFN0YXRlIiwicmVtb3ZlIiwia2V5Q29kZSIsInJhdGluZyIsInZhbHVlIiwic3RhcnMiLCJzdGFyIiwiayIsInByZXZBbGwiLCJlbGVtZW50IiwicmVzdWx0IiwicHJldmlvdXNFbGVtZW50U2libGluZyIsInB1c2giLCJuZXh0QWxsIiwibmV4dEVsZW1lbnRTaWJsaW5nIiwic3RhckZvY3VzIiwiZWwiLCIkIiwibmljZVNlbGVjdCIsIm91dGVyV2lkdGgiLCJ0b2dnbGUiLCJ0cmlnZ2VyIiwidCIsIm1vZGFsT3BlbiIsIm1vZGFsRWxlbWVudCIsIm1vZGFsQ29udGVudCIsImlubmVySFRNTCIsIm1vZGFsIiwidGluZ2xlIiwiY2xvc2VNZXRob2RzIiwib25DbG9zZSIsImNzc0NsYXNzIiwic2V0Q29udGVudCIsIm9wZW4iLCJmb3JtcyIsIm1vZGFsQm94Q29udGVudCIsImNsb3NlIl0sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsVUFBU0EsSUFBVCxFQUFlOztBQUVkO0FBQ0FDO0FBQ0FDOztBQUVBLE1BQU1DLGdCQUFnQjtBQUNwQixhQUFTO0FBQ1BDLGlCQUFXLE1BREo7QUFFUEMsZ0JBQVUsS0FGSDtBQUdQQyx1QkFBaUI7QUFIVjtBQURXLEdBQXRCOztBQVFBQyxXQUFTQyxnQkFBVCxDQUEwQixlQUExQixFQUEyQ0MsT0FBM0MsQ0FBbUQsVUFBQ0MsTUFBRCxFQUFTQyxDQUFULEVBQWU7QUFDaEUsUUFBTUMsU0FBU0YsT0FBT0csYUFBUCxDQUFxQixzQkFBckIsQ0FBZjtBQUFBLFFBQ01DLGNBQWNGLE9BQU9HLFFBQVAsQ0FBZ0JDLE1BRHBDO0FBQUEsUUFFTUMsYUFBYVAsT0FBT1EsT0FBUCxDQUFlUixNQUZsQztBQUFBLFFBR01TLFVBQVVoQixjQUFjYyxVQUFkLENBSGhCO0FBQUEsUUFJTUcsY0FBY1YsT0FBT1csV0FKM0I7QUFBQSxRQUtNQyxhQUFhVixPQUFPRyxRQUFQLENBQWdCLENBQWhCLEVBQW1CTSxXQUx0QztBQUFBLFFBTU1FLGlCQUFpQkMsS0FBS0MsS0FBTCxDQUFXTCxjQUFZRSxVQUF2QixDQU52QjtBQUFBLFFBT01JLFdBQVdoQixPQUFPRyxhQUFQLENBQXFCLHdCQUFyQixDQVBqQjtBQUFBLFFBUU1jLGVBQWVELFNBQVNiLGFBQVQsQ0FBdUIsNkJBQXZCLENBUnJCO0FBQUEsUUFTTWUs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MEIsbUJBQTFCLEVBQStDQyxPQUEvQyxDQUF1RCxVQUFDNEUsT0FBRCxFQUFVMUUsQ0FBVixFQUFnQjtBQUNyRTBFLFlBQVF6QyxnQkFBUixDQUF5QixPQUF6QixFQUFrQyxVQUFDQyxDQUFELEVBQU87QUFDdkNBLFFBQUVDLGNBQUY7O0FBRUEsVUFBTXdDLElBQUl6QyxFQUFFYSxNQUFGLENBQVNDLE9BQVQsQ0FBaUIsbUJBQWpCLENBQVY7QUFBQSxVQUNNRSxPQUFPeUIsRUFBRXBFLE9BQUYsQ0FBVXFFLFNBRHZCO0FBQUEsVUFFTUMsZUFBZWpGLFNBQVNNLGFBQVQsbUJBQXVDZ0QsSUFBdkMsUUFGckI7O0FBSUEsVUFBSTRCLGVBQWVELGFBQWFFLFNBQWhDOztBQUVBLFVBQUlDLFFBQVEsSUFBSUMsT0FBT0QsS0FBWCxDQUFpQjtBQUMzQkUsc0JBQWMsQ0FBQyxTQUFELEVBQVksUUFBWixDQURhO0FBRTNCQyxpQkFBUyxtQkFBVztBQUNsQixlQUFLN0IsTUFBTDtBQUNELFNBSjBCO0FBSzNCOEIsa0JBQVVQLGFBQWFoRDtBQUxJLE9BQWpCLENBQVo7O0FBUUFtRCxZQUFNSyxVQUFOLENBQWlCUCxZQUFqQjtBQUNBRSxZQUFNTSxJQUFOOztBQUVBLFVBQU1DLFFBQVFQLE1BQU1RLGVBQU4sQ0FBc0IzRixnQkFBdEIsQ0FBdUMsTUFBdkMsQ0FBZDs7QUFFQSxVQUFJO0FBQ0ZELGlCQUFTTSxhQUFULENBQXVCLGVBQXZCLEVBQXdDK0IsZ0JBQXhDLENBQXlELE9BQXpELEVBQWtFLFVBQUNDLENBQUQsRUFBTztBQUN2RUEsWUFBRUMsY0FBRjtBQUNBNkMsZ0JBQU1TLEtBQU47QUFDRCxTQUhEO0FBSUQsT0FMRCxDQUtFLE9BQU92RCxDQUFQLEVBQVUsQ0FFWDtBQUNGLEtBOUJEO0FBK0JELEdBaENEO0FBbUNELENBL09ELEVBK09HWCxNQS9PSCIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24ocm9vdCkge1xuXG4gIC8vIHN2ZyBmb3IgYWxsXG4gIHN2ZzRldmVyeWJvZHkoKVxuICBzY3JvbGxUbygpXG5cbiAgY29uc3Qgc2xpZGVyT3B0aW9ucyA9IHtcbiAgICAnaXRlbXMnOiB7XG4gICAgICBjZWxsQWxpZ246ICdsZWZ0JyxcbiAgICAgIHBhZ2VEb3RzOiBmYWxzZSxcbiAgICAgIHByZXZOZXh0QnV0dG9uczogZmFsc2UsXG4gICAgfVxuICB9XG5cbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtc2xpZGVyXScpLmZvckVhY2goKHNsaWRlciwgaSkgPT4ge1xuICAgIGNvbnN0IHNsaWRlcyA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zbGlkZXItc2xpZGVzXScpLFxuICAgICAgICAgIHNsaWRlc0NvdW50ID0gc2xpZGVzLmNoaWxkcmVuLmxlbmd0aCxcbiAgICAgICAgICBzbGlkZXJEYXRhID0gc2xpZGVyLmRhdGFzZXQuc2xpZGVyLFxuICAgICAgICAgIG9wdGlvbnMgPSBzbGlkZXJPcHRpb25zW3NsaWRlckRhdGFdLFxuICAgICAgICAgIHNsaWRlcldpZHRoID0gc2xpZGVyLm9mZnNldFdpZHRoLFxuICAgICAgICAgIHNsaWRlV2lkdGggPSBzbGlkZXMuY2hpbGRyZW5bMF0ub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgc2xpZGVzQ2FwYWNpdHkgPSBNYXRoLnJvdW5kKHNsaWRlcldpZHRoL3NsaWRlV2lkdGgpLFxuICAgICAgICAgIGNvbnRyb2xzID0gc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNsaWRlci1jb250cm9sc10nKSxcbiAgICAgICAgICBjb250cm9sc1ByZXYgPSBjb250cm9scy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zbGlkZXItY29udHJvbHMtcHJldl0nKSxcbiAgICAgICAgICBjb250cm9sc05leHQgPSBjb250cm9scy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zbGlkZXItY29udHJvbHMtbmV4dF0nKSxcbiAgICAgICAgICBjb250cm9sc0VuZEluZGV4ID0gc2xpZGVzQ291bnQgLSBzbGlkZXNDYXBhY2l0eSxcbiAgICAgICAgICBhZGFwdGl2ZSA9IE51bWJlcihzbGlkZXIuZGF0YXNldC5zbGlkZXJBZGFwdGl2ZSksXG4gICAgICAgICAgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCxcbiAgICAgICAgICBwcm9ncmVzc0JhciA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zbGlkZXItcHJvZ3Jlc3NdJyksXG4gICAgICAgICAgcHJvZ3Jlc3NTdGVwID0gTWF0aC5yb3VuZCgxMDAgLyAoc2xpZGVzQ291bnQtc2xpZGVzQ2FwYWNpdHkrMSkpXG5cbiAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IGAke3Byb2dyZXNzU3RlcH0lYFxuXG4gICAgaWYgKHNsaWRlc0NvdW50ID4gc2xpZGVzQ2FwYWNpdHkpIHtcbiAgICAgIHNsaWRlci5jbGFzc0xpc3QuYWRkKCdzbGlkZXJfaW5pdGlhbCcpXG4gICAgICBjb25zdCBmbGt0eSA9IG5ldyBGbGlja2l0eShzbGlkZXMsIHNsaWRlck9wdGlvbnNbc2xpZGVyLmRhdGFzZXQuc2xpZGVyXSk7XG5cbiAgICAgIGlmIChjb250cm9scykge1xuICAgICAgICBjb250cm9sc1ByZXZcbiAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBmbGt0eS5wcmV2aW91cygpXG4gICAgICAgICAgfSlcblxuICAgICAgICBjb250cm9sc05leHRcbiAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBmbGt0eS5uZXh0KClcbiAgICAgICAgICB9KVxuXG4gICAgICAgIGlmIChmbGt0eS5zZWxlY3RlZEluZGV4ID09PSAwKSB7XG4gICAgICAgICAgY29udHJvbHNQcmV2LmRpc2FibGVkID0gdHJ1ZVxuICAgICAgICB9IGVsc2UgaWYgKGZsa3R5LnNlbGVjdGVkSW5kZXggPT09IGNvbnRyb2xzRW5kSW5kZXgpIHtcbiAgICAgICAgICBjb250cm9sc05leHQuZGlzYWJsZWQgPSB0cnVlXG4gICAgICAgIH1cblxuICAgICAgICBmbGt0eS5vbignc2VsZWN0JywgKGluZGV4KSA9PiB7XG4gICAgICAgICAgbGV0IHByb2dyZXNzQ3VycmVudCA9IHBhcnNlSW50KHByb2dyZXNzQmFyLnN0eWxlLmxlZnQpIHx8IDBcblxuICAgICAgICAgIGNvbnRyb2xzUHJldi5kaXNhYmxlZCA9IChpbmRleCA9PSAwKSA/IHRydWUgOiBmYWxzZVxuICAgICAgICAgIGNvbnRyb2xzTmV4dC5kaXNhYmxlZCA9IChpbmRleCA9PSBjb250cm9sc0VuZEluZGV4KSA/IHRydWUgOiBmYWxzZVxuXG4gICAgICAgICAgcHJvZ3Jlc3NCYXIuc3R5bGUubGVmdCA9IGAke3Byb2dyZXNzU3RlcCppbmRleH0lYFxuICAgICAgICB9KVxuXG4gICAgICAgIGZsa3R5Lm9uKCdjaGFuZ2UnLCAoaW5kZXgpID0+IHtcbiAgICAgICAgICBpZiAoaW5kZXggPj0gY29udHJvbHNFbmRJbmRleCkge1xuICAgICAgICAgICAgZmxrdHkuc2VsZWN0KGNvbnRyb2xzRW5kSW5kZXgpXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfSlcblxuICAvLyBkcm9wXG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIGNvbnN0IGRyb3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1kcm9wLXN0YXRlPVwiMVwiXScpXG5cbiAgICBpZiAoZHJvcCAmJiAhZS50YXJnZXQuY2xvc2VzdCgnLmRyb3Auc2hvdycpICYmICFlLnRhcmdldC5jbG9zZXN0KCdbZGF0YS1kcm9wLXN0YXRlPVwiMVwiXScpKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIGRyb3AuY2xpY2soKVxuICAgIH1cblxuICB9KVxuXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWRyb3BdJykuZm9yRWFjaCgoZHJvcCwgaSkgPT4ge1xuICAgIGRyb3AuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICAgIGNvbnN0IGRhdGEgPSBkcm9wLmRhdGFzZXQuZHJvcCxcbiAgICAgICAgICAgIGRyb3BDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtZHJvcC1jb250ZW50PVwiJHtkYXRhfVwiXWApLFxuICAgICAgICAgICAgc3RhdGUgPSBOdW1iZXIoZHJvcC5kYXRhc2V0LmRyb3BTdGF0ZSlcblxuICAgICAgc3dpdGNoIChzdGF0ZSkge1xuICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgZHJvcENvbnRlbnQuY2xhc3NMaXN0LmFkZCgnc2hvdycpXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIGRyb3BDb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKVxuICAgICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGRyb3AuZGF0YXNldC5kcm9wU3RhdGUgPSBOdW1iZXIoIXN0YXRlKVxuXG4gICAgfSlcblxuICAgIGRyb3AuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XG4gICAgICBpZiAoZS5rZXlDb2RlID09PSAxMykge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgZS50YXJnZXQuY2xpY2soKVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG5cbiAgLy8gcmF0aW5nXG5cbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJhdGluZycpLmZvckVhY2goKHJhdGluZywgaSkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gTnVtYmVyKHJhdGluZy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1zdGFyc10nKS5kYXRhc2V0LnN0YXJzKVxuXG4gICAgcmF0aW5nLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdGFyJykuZm9yRWFjaCgoc3RhciwgaykgPT4ge1xuICAgICAgaWYgKGsgPCB2YWx1ZSkge1xuICAgICAgICBzdGFyLmNsYXNzTGlzdC5hZGQoJ3N0YXJfZmlsbCcpXG4gICAgICB9XG4gICAgfSlcbiAgfSlcblxuICBmdW5jdGlvbiBwcmV2QWxsKGVsZW1lbnQpIHtcbiAgICB2YXIgcmVzdWx0ID0gW107XG5cbiAgICB3aGlsZSAoZWxlbWVudCA9IGVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZylcbiAgICAgICAgcmVzdWx0LnB1c2goZWxlbWVudCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIG5leHRBbGwoZWxlbWVudCkge1xuICAgIHZhciByZXN1bHQgPSBbXTtcblxuICAgIHdoaWxlIChlbGVtZW50ID0gZWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmcpXG4gICAgICAgIHJlc3VsdC5wdXNoKGVsZW1lbnQpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBzdGFyRm9jdXMoc3Rhcikge1xuICAgIHN0YXIuY2xhc3NMaXN0LmFkZCgnc3Rhcl9ob3ZlcicpXG5cbiAgICBwcmV2QWxsKHN0YXIpLmZvckVhY2goKGVsLCBrKSA9PiB7XG4gICAgICBlbC5jbGFzc0xpc3QuYWRkKCdzdGFyX2hvdmVyJylcbiAgICB9KVxuXG4gICAgbmV4dEFsbChzdGFyKS5mb3JFYWNoKChlbCwgaykgPT4ge1xuICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnc3Rhcl9ob3ZlcicpXG4gICAgfSlcbiAgfVxuXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdGFyJykuZm9yRWFjaCgoc3RhciwgaSkgPT4ge1xuICAgIHN0YXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIChlKSA9PiB7XG4gICAgICBzdGFyRm9jdXMoc3RhcilcbiAgICB9KVxuXG4gICAgc3Rhci5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIChlKSA9PiB7XG4gICAgICBzdGFyRm9jdXMoc3RhcilcbiAgICB9KVxuXG4gICAgc3Rhci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKGUpID0+IHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdGFyX2hvdmVyJykuZm9yRWFjaCgoZWwsIGspID0+IHtcbiAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnc3Rhcl9ob3ZlcicpXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBzdGFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgc3Rhci5jbGFzc0xpc3QuYWRkKCdzdGFyX2ZpbGwnKVxuXG4gICAgICBwcmV2QWxsKHN0YXIpLmZvckVhY2goKGVsLCBrKSA9PiB7XG4gICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ3N0YXJfZmlsbCcpXG4gICAgICB9KVxuXG4gICAgICBuZXh0QWxsKHN0YXIpLmZvckVhY2goKGVsLCBrKSA9PiB7XG4gICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoJ3N0YXJfZmlsbCcpXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBzdGFyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4ge1xuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgIHN0YXIuY2xpY2soKVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG5cbiAgLy8gc2VsZWN0XG4gICQoJ3NlbGVjdCcpLm5pY2VTZWxlY3QoKTtcblxuICAvLyBzaWRlIGFkYXB0aXZlXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdmF0YXInKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgaWYgKHdpbmRvdy5vdXRlcldpZHRoIDw9IDc2OCkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGFnZV9fc2lkZScpLmNsYXNzTGlzdC50b2dnbGUoJ3BhZ2VfX3NpZGVfc2hvdycpXG4gICAgfVxuICB9KVxuXG4gIC8vIG1vZGFsc1xuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1tb2RhbC1vcGVuXScpLmZvckVhY2goKHRyaWdnZXIsIGkpID0+IHtcbiAgICB0cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgICBjb25zdCB0ID0gZS50YXJnZXQuY2xvc2VzdCgnW2RhdGEtbW9kYWwtb3Blbl0nKSxcbiAgICAgICAgICAgIGRhdGEgPSB0LmRhdGFzZXQubW9kYWxPcGVuLFxuICAgICAgICAgICAgbW9kYWxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtbW9kYWw9XCIke2RhdGF9XCJdYClcblxuICAgICAgbGV0IG1vZGFsQ29udGVudCA9IG1vZGFsRWxlbWVudC5pbm5lckhUTUxcblxuICAgICAgbGV0IG1vZGFsID0gbmV3IHRpbmdsZS5tb2RhbCh7XG4gICAgICAgIGNsb3NlTWV0aG9kczogWydvdmVybGF5JywgJ2VzY2FwZSddLFxuICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB0aGlzLnJlbW92ZSgpXG4gICAgICAgIH0sXG4gICAgICAgIGNzc0NsYXNzOiBtb2RhbEVsZW1lbnQuY2xhc3NMaXN0XG4gICAgICB9KTtcblxuICAgICAgbW9kYWwuc2V0Q29udGVudChtb2RhbENvbnRlbnQpXG4gICAgICBtb2RhbC5vcGVuKClcblxuICAgICAgY29uc3QgZm9ybXMgPSBtb2RhbC5tb2RhbEJveENvbnRlbnQucXVlcnlTZWxlY3RvckFsbCgnZm9ybScpXG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgbW9kYWwuY2xvc2UoKVxuICAgICAgICB9KVxuICAgICAgfSBjYXRjaCAoZSkge1xuXG4gICAgICB9XG4gICAgfSlcbiAgfSlcblxuXG59KSh3aW5kb3cpO1xuIl19
